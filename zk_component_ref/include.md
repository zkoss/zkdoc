

# Include

- Demonstration:
  [Include](http://www.zkoss.org/zkdemo/composite/include)
- Java API: [org.zkoss.zul.Include](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zul/Include.html)
- JavaScript API: [zul.wgt.Include](https://www.zkoss.org/javadoc/latest/jsdoc/classes/zul.wgt.Include.html)


# Employment/Purpose

The `include` component is used to include the output generated by
another servlet. The servlet could be anything including JSF, JSP and
even another ZUML page.

```xml
<window title="include demo" border="normal" width="300px">
    Hello, World!
    <include src="/userguide/misc/includedHello.zul" />
    <include src="/html/frag.html?some=any" />
    <include src="mypage" argument="${anyValue}" other="${anotherValue}" />
</window>
```

Like all other properties, you could dynamically change the `src`
attribute to include the output from a different servlet at run time.

If the included output is from another ZUML, this allows developers to
access components in the included page as if they are part of the
containing page.

If the `include` component is used to include a ZUML page, the included
page will become part of the desktop. However, the included page is not
visible until the request is processed completely. In other words, it is
visible only in the following events, triggered by user or timer.

The reason is that the include component includes a page as late as the
Rendering phase. On the other hand, zscript takes place at the Component
Creation phase, and onCreate takes place at the Event Processing Phase.
They both execute before the inclusion.

# Example

```xml
<window title="include demo" border="normal" width="300px">
    Hello, World!
    <include src="/userguide/misc/includedHello.zul" />
    <include src="/html/frag.html?some=any" />
    <include src="mypage" argument="${anyValue}" other="${anotherValue}" />
</window>
```

# Modes

There are two ways to include another ZUML document: `instant` and
`defer`. It is controlled by the property called mode
([org.zkoss.zul.Include#setMode(java.lang.String)](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zul/Include.html#setMode(java.lang.String))).
By default, it is `auto`, i.e., the real mode is decided automatically
as described below. Notice that the included file should not contain
\<html\> tag.

## Auto

The `auto` mode (default) decides the mode based the page to include. If
the page
([org.zkoss.zul.Include#setSrc(java.lang.String)](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zul/Include.html#setSrc(java.lang.String)))
is ended with the extension named `.zul`, `.zhtml`, `.html`, or
`.xhtml`, the `instant` mode is assumed. Otherwise, the `defer` mode is
assumed. If it is not the case (such as your ZUML page's extension is
not any of them), you could specify the mode explicitly.

Notice that if a query string is specified, the `defer` mode is assumed,
too, since the `instant` mode does not support the query string (#1).

> ------------------------------------------------------------------------
>
> That means , the following sample is using `defer` mode so the
> \${param.test} in header.zul is working .
>
> ```xml
>    <include src="header.zul?test=5" />                          <!-- default mode is auto -->
> ```
>
> but the following sample is using `instant` mode , so the
> \${param.test} in the header.zul is not working.
>
> ```xml
>    <include mode="instant" src="header.zul?test=5" />       <!-- set the instant mode explicitly -->
> ```
>
> If you have no any query string in src and it's ended with ".zul" ,
> the include will be `instant` mode by default.
>
> ```xml
>    <include src="header.zul" />                                <!-- default mode is auto -->
> ```
>
> ------------------------------------------------------------------------

The code below demonstrates how to use the *auto* mode:

```xml
<window title="demo" border="normal">
    <include mode="auto" src="another.zul" />
</window>
```

## Instant

In the `instant` mode, the `include` component loads the page by the use
of
[org.zkoss.zk.ui.Execution#createComponents(java.lang.String, org.zkoss.zk.ui.Component, java.util.Map)](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Execution.html#createComponents(java.lang.String, org.zkoss.zk.ui.Component, java.util.Map)).
It means that the components defined in the included page are
instantiated *instantly* and added as children of the `include`
component.

Unlike the `defer` mode, no additional
[org.zkoss.zk.ui.Page](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Page.html) instance is
created.

The code below demonstrates how to use the *instant* mode:

```xml
<window title="demo" border="normal">
    <include mode="instant" src="include.zul" />
</window>
```

Notice the `include` component itself is [a ID space owner]({{site.baseurl}}/zk_dev_ref/ui_composing/id_space), so
there is no issue of ID conflicts. But, it also means you have to use
[org.zkoss.zk.ui.Path](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Path.html) or other techniques to retrieve
the child components.

### Pass Values to the Included Page

you can pass values through
[org.zkoss.zul.Include#setDynamicProperty(java.lang.String, java.lang.Object)](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zul/Include.html#setDynamicProperty(java.lang.String, java.lang.Object)).
Unlike the *defer* mode, the query string is not supported in the
*instant* mode.

For example:

```xml
 <include src="mypage" some="something" another="${expr}"/>
```

Then, you could retrieve the values by use [the arg object](zuml_ref/arg)
as described in [the Load ZUML in Java section]({{site.baseurl}}/zk_dev_ref/ui_composing/load_zuml_in_java).

> ------------------------------------------------------------------------
>
> In the `defer` mode, the values have to be retrieved by [the > requestScope > object](zuml_ref/requestscope).
>
> ------------------------------------------------------------------------
>
> Unfortunately there is [a > bug](https://sourceforge.net/tracker/?func=detail&aid=3142583&group_id=152762&atid=785191)
> in 5.0.5, so it won't work unless you use 5.0.6 or later.

## Defer

In the `defer` mode, the `include` component includes the page by going
through the Servlet container(the include method of
javax.servlet.RequestDispatcher). Thus, it is OK to include any kind of
pages, not limited to ZUML documents.

```xml
<window title="demo" border="normal">
    <include mode="defer" src="include.zul" />
</window>
```

### Differences to the Instant Mode

Here is a list of differences between the `defer` and `instant` modes if
a ZUML document is included (directly or indirectly going through
another, say, JSP page) to contain the components defined in the
included ZUML document.

- In the `defer` mode, an instance of
  [org.zkoss.zk.ui.Page](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Page.html) will be
  created.
- In the `defer` mode, the instantiated components become the root of
  the [org.zkoss.zk.ui.Page](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Page.html) instance.
  The `include` component itself has no child component at all.
- In the `defer` mode, the page is included when the `include` component
  is rendered. Thus, the
  [org.zkoss.zk.ui.Page](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Page.html) instance (and
  its content) is not available when loading the ZUML document that the
  `include` component belongs to. It means you cannot access any of its
  content until receiving an AU request from the client.

### Pass Values to the Included Page

There are two ways to pass values to the included page in the `defer`
mode. First, you can pass them with the query string.

```xml
 <include mode="defer" src="mypage?some=something"/>
```

Then, in the included page, you can access them with
[org.zkoss.zk.ui.Execution#getParameter(java.lang.String)](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Execution.html#getParameter(java.lang.String))
or the `javax.servlet.ServletRequest` interface. In EL expressions (of
the included page), you can use [the `param` object](zuml_ref/param)
or [the paramValues object](zuml_ref/paramvalues)
to access them.

```xml
 ${param.some}
```

Notice that you can only pass String-typed values with the query string.
Alternatively, we can pass any kind of values with the so-called dynamic
properties by use of
[org.zkoss.zul.Include#setDynamicProperty(java.lang.String, java.lang.Object)](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zul/Include.html#setDynamicProperty(java.lang.String, java.lang.Object))
or, in ZUL, a dynamic property as follows:

```xml
<include mode="defer" src="mypage" some="something" another="${expr}"/>
```

With the dynamic properties, you can pass non-String-typed values. In
the included page, you can access them with
[org.zkoss.zk.ui.Execution#getAttribute(java.lang.String)](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Execution.html#getAttribute(java.lang.String))
or the `javax.servlet.ServletRequest` interface. In EL expressions (of
the included page), you can use [the requestScope object](zuml_ref/requestscope)
to access them.

```xml
 ${requestScope.some}
```

### Include the Same Page Twice

With the include component, you could include any pages multiple times
no matter it is in the `instant` or `defer` mode. For example,

```xml
<include src="/mypage.zul"/>
<include src="/mypage.zul"/>
```

However, if you are using the `defer` mode and want to access the
component inside of them, you have to assign a unique identifier of the
page being included. Here is what you can do.

```xml
<include mode="defer" src="/mypage.zul?pageId=first"/>
<include mode="defer" src="/mypage.zul?pageId=second"/>
```

In additions, in the page being include, i.e., `mypage.zul` in this
example, you have to write

```xml
<?page id="${param.pageId}"?>
```

Then, you could access their component by the use of
[org.zkoss.zk.ui.Path](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Path.html) as follows.

```xml
Path.getComponent('//first/textbox/'); 
Path.getComponent('//second/textbox/'); 
```

Notice that, in the `defer` mode, components are created as late as
rendering the `include` component, so you could access them only in the
event listener serving AU requests (aka., Ajax).

### Include Non-ZUML Pages

If the included page is not ZUML (such as a HTML fragment), the content
is generated directly, so they might be evaluated before widgets are
rendered. Technically it is OK. However, if the included page embeds
some JavaScript code that depends on widgets, it might run as you
expected. For example, assume we have the includer and included page as
follows:

```xml
<!-- includer -->
<window id="main">
  <include src="frag.html"/>
</window>
```

```xml
<!-- included -->
<script>zk.log(jq("$main"));</script>
```

Then, `jq("$main")` will resolve nothing (an empty array) because its
content is evaluated first.

There are two solutions to make it evaluate later:

1.  Use
    [\_global\_.zk#afterMount(_global_.Function, int)](https://www.zkoss.org/javadoc/latest/jsdoc/classes/\_global\_.zk.html#afterMount(_global_.Function, int))
    in the included page
2.  Or, specify this custom attribute to defer the rendering in the
    includer.

**Use zk.afterMount() in the included page**

First, you could use
[\_global\_.zk#afterMount(_global_.Function, int)](https://www.zkoss.org/javadoc/latest/jsdoc/classes/\_global\_.zk.html#afterMount(_global_.Function, int))
to defer the evaluation as follows in the included page:

```html
<!-- the included non-ZUML page -->
<script>
zk.afterMount(function () {
    zk.log(jq("$main"));
    ...//handle widgets:
});
</script>
```

**Use the org.zkoss.zul.include.html.defer attribute**

{% include version-badge.html version=5.0.7 %}

Alternatively, you could specify a custom attribute called
`the org.zkoss.zul.include.html.defer` in the
[org.zkoss.zul.Include](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zul/Include.html) component (rather than using
[\_global\_.zk#afterMount(_global_.Function, int)](https://www.zkoss.org/javadoc/latest/jsdoc/classes/\_global\_.zk.html#afterMount(_global_.Function, int))
in the included component):

```xml
<!-- the includee -->
<include src="included.html">
    <custom-attributes org.zkoss.zul.include.html.defer="true"/>
</include>
```

## Backward Compatibility

For versions prior to 5.0, the `defer` mode is the default. If you
prefer to keep using the defer mode, you could specify a library
property called
[org.zkoss.zul.include.mode]({{site.baseurl}}/zk_config_ref/org_zkoss_zul_include_mode)
as follows.

```xml
<library-property>
    <name>org.zkoss.zul.include.mode</name>
     <value>defer</value>
</library-property>
```

# Refresh Included Pages

First, use the `include` component with either the `instant` or `defer`
mode to include whatever page you want (ZUML, JSP, JSF or whatever)
inside a ZK document. Second, you can dynamically change it by changing
the `src` property
([org.zkoss.zul.Include#setSrc(java.lang.String)](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zul/Include.html#setSrc(java.lang.String)).

For example, the following code would change the included page from
`hello.zul` to `byebye.zul`, when an end user press the `Bye!` button.

```xml
<include id="inner" src="hello.zul"/>
<button label="Bye!" onClick='inner.src = "byebye.zul"'/>
```

If you want to *reload* the same page (and not to change to another
page), you have to set the `src` property to null first; then set it
back to what it was. Because ZK optimizes operations, setting the same
value to the same property would be deemed to do nothing.

For example, the following code would refresh the `hello.zul` page when
an end user press the `Reload` button.

```xml
<include id="inner" src="hello.zul"/>
<button id="reload" label="Reload" onClick="String tmp=inner.src; inner.src=null; inner.src=tmp;"/>
```

Another way to reload is to invalidate the "include" component by use of
[org.zkoss.zk.ui.Component#invalidate()](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Component.html#invalidate())
as follows.

```xml
<include id="inner" src="hello.zul"/>
<button id="reload" label="Reload" onClick="inner.invalidate();"/>
```

Notice that
[org.zkoss.zk.ui.Component#invalidate()](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zk/ui/Component.html#invalidate())
will cause the included page to be reloaded in both the `instance` and
`defer` mode.

# Access Components Inside

Since `include` creates ID space, to access components inside it ,
please refer to
[{{site.baseurl}}/zk_dev_ref/ui_composing/id_space#Find_Component_Manually]({{site.baseurl}}/zk_dev_ref/ui_composing/id_space#Find_Component_Manually)

# Progressing for Slow Pages

If an included page takes too long to load, you could specify true to
the `progressing` property
([org.zkoss.zul.Include#setProgressing(boolean)](https://www.zkoss.org/javadoc/latest/zk/org/zkoss/zul/Include.html#setProgressing(boolean))).
Thus, the included page won't load in the same HTTP request, so the
including page will be ready to the client as soon as possible.

```xml
<include page="slow.zul" progressing="true"/>
```

ZK Client Engine will show a busy message to indicate that the page is
not ready yet, and this prevents users from accessing it. Then, the real
loading of the included page will then take place later. Though the end
user still cannot access the page, the feed back is much better (with a
*semi-ready* page than totally blank).

This feature is actually done by the use of the so-called [echo event]({{site.baseurl}}/zk_dev_ref/event_handling/event_firing).
For more information, please refer to the [Long Operations: Use Echo Events]({{site.baseurl}}/zk_dev_ref/ui_patterns/use_echo_events)
section.

This feature cannot be used with the `instant` mode. If the `auto` mode
is used (default), it switches to the defer mode automatically.

# Custom Attributes

## org.zkoss.zul.include.html.defer

`[default: false]`  
`[inherit: true]`[^1]

{% include version-badge.html version=5.0.7 %}

It specifies whether to defer the rendering of the included non-ZUML
page, until all widgets are instantiated and rendered at the client. By
default, if the included page is not ZUML (i.e., HTML fragment), the
content is generated directly, and they might be evaluated before
widgets are rendered (depending on the browser and the complexity of a
page).

For more information, please refer to the [\#Include Non-ZUML Pages](#Include_Non-ZUML_Pages) section.

> ------------------------------------------------------------------------
>
> <references/>

# Supported Events

<table>
<thead>
<tr class="header">
<th><center>
<p>Name</p>
</center></th>
<th><center>
<p>Event Type</p>
</center></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>None</p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>

- Inherited Supported Events: [ XulElement]({{site.baseurl}}/zk_component_ref/base_components/xulelement#Supported_Events)

# Supported Children

`*NONE`

# Use Cases

| Version | Description | Example Location |
|---------|-------------|------------------|
|         |             |                  |

# Version History



| Version | Date         | Content                                                                                                                                                                                                                                                                                      |
|---------|--------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 5.0.0   | January 2010 | The mode is default to `auto` (rather than `defer`). You could configure the default mode to defer by specifying a library property called [org.zkoss.zul.include.mode]({{site.baseurl}}/zk_config_ref/org_zkoss_zul_include_mode) in `WEB-INF/zk.xml`. |
| 5.0.7   | April 2011   | The custom attribute called `org.zkoss.zul.include.html.defer` was introduced to defer the rendering of a non-ZUML page (such as HTML fragment) until all widgets are instantiated and rendered at the client.                                                                               |



[^1]: `The custom attribute could be specified in this component, or any of its ancestor. In addition, it could be specified as `[`a library property`]({{site.baseurl}}/zk_config_ref/the_library_property_element)` to enable or disable it for the whole application.`
